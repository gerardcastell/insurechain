generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int        @id @default(autoincrement())
  email     String     @unique
  password  String
  proposals Proposal[]
}

model Proposal {
  id                   Int           @id @default(autoincrement())
  policyHolderId       Int
  smartContractAddress String?       @unique
  coverages            CoverageType[]
  policyHolder         User          @relation(fields: [policyHolderId], references: [id])
  riskObject           RiskObject?
  riskSubject          RiskSubject?
}

model RiskObject {
  id           Int         @id @default(autoincrement())
  model        String
  power        Int
  purchaseDate DateTime
  plate        String      @unique
  kmsYear      Int
  proposalId   Int         @unique
  numberDoors  Int
  maker        String
  releaseDate  DateTime
  retailPrice  Float
  version      String
  fuelType     FuelType
  parking      ParkingType
  proposal     Proposal    @relation(fields: [proposalId], references: [id])
}

model RiskSubject {
  id             Int      @id @default(autoincrement())
  name           String
  documentNumber String   @unique
  proposalId     Int      @unique
  birthDate      DateTime
  proposal       Proposal @relation(fields: [proposalId], references: [id])
}

model CoverageProduct {
  id              Int      @id @default(autoincrement())
  identifier      Coverage @unique
  basePriceFactor Float
  title           String
  description     String
}

model CoverageType {
  id          Int      @id @default(autoincrement())
  identifier  Coverage
  premium     Float
  title       String
  description String
  proposalId  Int      @unique
  proposal    Proposal @relation(fields: [proposalId], references: [id])
}

enum Coverage {
  third_party_liability
  wildlife_collision
  theft
  roadside_assistance
  fire_windscreen
  vehicle_damages
  replacement_vehicle
}

enum FuelType {
  gasoline
  diesel
  hybrid
  electric
}

enum ParkingType {
  street
  collective_car_park
  collective_car_park_surveillance
  garage
}
